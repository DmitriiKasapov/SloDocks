# Руководство по блочной системе материалов

## Концепция

**Материал** — это страница, собранная из переиспользуемых блоков контента.

**Блоки** — универсальные типы контента, которые можно комбинировать в любом порядке.

## Структура данных

```
Material (страница)
  ├── title
  ├── slug
  ├── subtitle
  ├── service_id (nullable)
  ├── status (draft/published)
  └── MaterialBlocks (1..N)
        ├── type (intro, steps, tip, etc.)
        ├── content (JSON)
        └── order
```

## Типы блоков (8 базовых)

### 1️⃣ Intro — вводный блок

**Назначение:** Hero-блок с кратким описанием и бейджем

**Структура:**
```json
{
  "text": "Полные материалы и инструкции",
  "badge": "Актуально на 2026"
}
```

**Когда использовать:** В начале материала для введения

---

### 2️⃣ Process Overview — краткий обзор шагов

**Назначение:** Показать весь процесс одним взглядом

**Структура:**
```json
{
  "steps": [
    {"step": "Подготовить документы"},
    {"step": "Определить школу"},
    {"step": "Записать ребёнка"}
  ]
}
```

**Когда использовать:** После intro, чтобы дать общее представление

---

### 3️⃣ Steps — пошаговая инструкция

**Назначение:** Детальное руководство по шагам

**Структура:**
```json
{
  "steps": [
    {
      "number": 1,
      "title": "Подготовка документов",
      "description": "<p>Перед началом...</p>",
      "items": [
        {"item": "Свидетельство о рождении"},
        {"item": "Справка о прививках"}
      ]
    }
  ]
}
```

**Когда использовать:** Основной контент с детальными инструкциями

---

### 4️⃣ Tip — полезный совет

**Назначение:** Выделить важную информацию

**Структура:**
```json
{
  "level": "info",  // info | warning | success
  "text": "<p>Школа обязана предоставить...</p>"
}
```

**Когда использовать:** Между шагами для важных замечаний

---

### 5️⃣ Downloads — бланки для скачивания

**Назначение:** Предоставить файлы для скачивания

**Структура:**
```json
{
  "files": [
    {
      "title": "Заявление о приёме",
      "file": "materials/downloads/application.pdf"
    }
  ]
}
```

**Когда использовать:** Когда нужны официальные бланки

---

### 6️⃣ Examples — образцы заполнения

**Назначение:** Показать примеры заполненных документов

**Структура:**
```json
{
  "examples": [
    {
      "title": "Пример заполнения заявления",
      "file": "materials/examples/example.pdf"
    }
  ]
}
```

**Когда использовать:** После downloads для демонстрации

---

### 7️⃣ FAQ — часто задаваемые вопросы

**Назначение:** Ответить на типичные вопросы

**Структура:**
```json
{
  "items": [
    {
      "q": "Можно ли записаться в течение года?",
      "a": "Да, при переезде это допускается."
    }
  ]
}
```

**Когда использовать:** В конце материала

---

### 8️⃣ Help CTA — блок помощи

**Назначение:** Призыв к действию / контакт

**Структура:**
```json
{
  "text": "<p>Если возникли сложности...</p>",
  "link": "/contact"
}
```

**Когда использовать:** В самом конце

---

## Как работает админка

### Экран редактирования материала

1. **Основная информация:**
   - Заголовок
   - Slug
   - Короткое описание
   - Привязка к услуге
   - Статус (draft/published)

2. **Конструктор блоков:**
   - Drag & Drop для изменения порядка
   - Кнопка "Добавить блок"
   - Выбор типа блока
   - Форма редактирования в зависимости от типа

### Пример рабочего процесса

```
1. Создаём новый материал
   ↓
2. Заполняем title, slug, subtitle
   ↓
3. Добавляем блоки:
   - Intro (приветствие)
   - Process Overview (обзор)
   - Steps (детали)
   - Tip (совет)
   - Downloads (файлы)
   - Help CTA (контакт)
   ↓
4. Меняем порядок при необходимости
   ↓
5. Публикуем (status = published)
```

## Преимущества системы

✅ **Гибкость:** Любой порядок блоков
✅ **Переиспользование:** Одни и те же типы везде
✅ **Масштабируемость:** Легко добавить новый тип
✅ **Простота:** Нет дублирования кода
✅ **Визуальная сборка:** Админ видит структуру сразу

## Добавление нового типа блока

### 1. Добавить константу в MaterialBlock.php

```php
public const TYPE_NEW_BLOCK = 'new_block';

public static function getTypes(): array
{
    return [
        // ...
        self::TYPE_NEW_BLOCK => 'New Block',
    ];
}
```

### 2. Добавить в MaterialResource.php

```php
Builder\Block::make('new_block')
    ->label('New Block — описание')
    ->icon('heroicon-o-icon-name')
    ->schema([
        TextInput::make('field1')->label('Поле 1'),
        Textarea::make('field2')->label('Поле 2'),
    ]),
```

### 3. Создать Blade компонент

`resources/views/components/material-blocks/new-block.blade.php`:

```blade
@props(['content'])

<div class="mb-10">
    <h2>{{ $content['field1'] ?? '' }}</h2>
    <p>{{ $content['field2'] ?? '' }}</p>
</div>
```

✅ Готово! Новый блок доступен в админке.

## Примеры использования

### Простой материал (MVP)

```
1. Intro
2. Steps
3. Tip
4. Help CTA
```

### Полный материал

```
1. Intro
2. Process Overview
3. Steps (шаг 1)
4. Tip
5. Steps (шаг 2)
6. Downloads
7. Examples
8. Steps (шаг 3)
9. FAQ
10. Help CTA
```

### Только FAQ

```
1. Intro
2. FAQ
3. Help CTA
```

## Технические детали

### Модели

- **Material** — обёртка страницы
- **MaterialBlock** — отдельный блок с JSON content

### Хранение

- `materials` — основная информация
- `material_blocks` — блоки (type + content JSON + order)

### Отношения

```
Material hasMany MaterialBlock
MaterialBlock belongsTo Material
Service hasOne Material (optional)
```

### Рендеринг

```blade
@foreach($material->activeBlocks as $block)
    <x-dynamic-component
        :component="'material-blocks.' . $block->type"
        :content="$block->content"
    />
@endforeach
```

## Лучшие практики

✅ **DO:**
- Использовать блоки как LEGO
- Группировать связанные шаги
- Ставить Tip между сложными шагами
- Заканчивать с Help CTA

❌ **DON'T:**
- Не делать отдельные таблицы под каждый тип
- Не хардкодить контент в компонентах
- Не усложнять структуру JSON без необходимости

## Миграция со старой структуры

Если у вас есть ServiceContent, можно:

1. Создать Material для каждого Service
2. Разбить content на блоки Steps
3. hidden_text_1 → блок Steps
4. hidden_links → блок Downloads

Скрипт миграции можно написать отдельно при необходимости.

---

## Вопросы?

- Нужен ли новый тип блока? → Подумайте, нельзя ли использовать существующий
- Как изменить порядок? → Drag & Drop в админке
- Как скрыть блок? → Удалите или измените is_active
- Можно ли повторять блоки? → Да! Несколько Steps, несколько Tip и т.д.
