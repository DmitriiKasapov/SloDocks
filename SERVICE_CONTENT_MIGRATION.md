# Разделение Service и ServiceContent

## Что изменилось

Контент услуги (публичный и скрытый) перенесён из таблицы `services` в отдельную таблицу `service_contents`.

### Структура

**До:**
- `services` — содержала все данные (основное + контент)

**После:**
- `services` — только основная информация (название, цена, описание, SEO)
- `service_contents` — весь контент (текст страницы, файлы, скрытые материалы)

### Админка

Теперь в админке используются **вкладки (Tabs)**:

1. **Основное** — название, slug, категория, теги, краткое описание, цена, доступ, статус, SEO
2. **Материалы** — публичный контент (текст страницы, изображение) и скрытый контент (инструкция, PDF, ссылки, советы)
3. **Доступ** — (пока пустая, для будущих функций)

## Применение изменений

### 1. Запуск миграций

Выполните миграции в следующем порядке:

```bash
php artisan migrate
```

Это выполнит три миграции:
1. `2026_02_01_100001_create_service_contents_table.php` — создание новой таблицы
2. `2026_02_01_100002_migrate_service_content_data.php` — перенос данных из `services` в `service_contents`
3. `2026_02_01_100003_drop_content_fields_from_services.php` — удаление старых полей из `services`

### 2. Проверка

После миграции проверьте:
- Все существующие услуги должны иметь связанную запись в `service_contents`
- В админке должны отображаться три вкладки
- Редактирование и создание услуг работает корректно

### 3. Откат (если нужно)

Если что-то пошло не так:

```bash
php artisan migrate:rollback --step=3
```

Это откатит все три миграции и вернёт данные в таблицу `services`.

## Изменения в коде

### Модели

**Service.php:**
- Удалены поля контента из `$fillable`
- Добавлена связь `hasOne(ServiceContent::class)`

**ServiceContent.php** (новая):
- Содержит все поля контента
- Связь `belongsTo(Service::class)`

### Resource

**ServiceResource.php:**
- Форма использует `Tabs` вместо множественных `Section`
- Поля контента используют dot notation: `content.hidden_text_1`

**CreateService.php:**
- `mutateFormDataBeforeCreate()` — извлекает данные контента
- `afterCreate()` — создаёт связанную запись `ServiceContent`

**EditService.php:**
- `mutateFormDataBeforeFill()` — загружает данные контента
- `mutateFormDataBeforeSave()` — извлекает данные контента
- `afterSave()` — обновляет или создаёт `ServiceContent`

## Преимущества

✅ Чистая структура данных
✅ Логическое разделение в админке
✅ Легче поддерживать и расширять
✅ Можно добавлять версионность контента в будущем
✅ Можно иметь несколько версий контента для одной услуги (draft/published)
