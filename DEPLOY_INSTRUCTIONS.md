# Инструкция по развёртыванию изменений ServiceContent

## Что изменилось

Контент услуги теперь хранится в отдельной таблице `service_contents` вместо прямых полей в `services`.

## Шаги развёртывания

### 1. Резервное копирование БД (обязательно!)

```bash
# MySQL
mysqldump -u username -p database_name > backup_$(date +%Y%m%d_%H%M%S).sql

# PostgreSQL
pg_dump database_name > backup_$(date +%Y%m%d_%H%M%S).sql
```

### 2. Применение изменений

```bash
# Перейдите в директорию проекта
cd D:\Projects\SloDoks

# Запустите миграции
php artisan migrate

# Проверьте, что миграции выполнились успешно
php artisan migrate:status
```

### 3. Проверка данных

```bash
# Проверьте, что данные перенесены
php artisan tinker
```

В tinker выполните:

```php
// Проверка количества услуг
\App\Models\Service::count();

// Проверка количества контентов (должно совпадать)
\App\Models\ServiceContent::count();

// Проверка связи
$service = \App\Models\Service::with('content')->first();
$service->content; // Должен вернуть объект ServiceContent
```

### 4. Тестирование админки

1. Откройте админку Filament
2. Перейдите к редактированию любой услуги
3. Убедитесь, что отображаются три вкладки:
   - Основное
   - Материалы
   - Доступ
4. Проверьте, что все поля загружаются корректно
5. Попробуйте сохранить изменения
6. Создайте новую услугу и убедитесь, что контент сохраняется

### 5. Тестирование публичных страниц

1. Откройте страницу любой услуги
2. Убедитесь, что она отображается без ошибок
3. Проверьте страницу с материалами (если есть временный доступ)

## Откат изменений

Если что-то пошло не так:

```bash
# Откат всех трёх миграций
php artisan migrate:rollback --step=3

# Проверка
php artisan migrate:status
```

После отката:
- Данные вернутся в таблицу `services`
- Таблица `service_contents` будет удалена
- Код будет работать со старой структурой (но могут быть ошибки в админке)

## Возможные проблемы

### Ошибка: "Class 'ServiceContent' not found"

```bash
# Обновите autoload
composer dump-autoload
```

### Ошибка при сохранении в админке

Убедитесь, что:
1. Миграции выполнены (`php artisan migrate:status`)
2. Autoload обновлён (`composer dump-autoload`)
3. Нет кеша конфигурации (`php artisan config:clear`)

### Контент не отображается во views

Убедитесь, что используете:
```php
$service->content?->hidden_text_1
```

А не:
```php
$service->hidden_text_1 // Старый способ
```

## Очистка кеша (если нужно)

```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear
```

## Проверочный список

- [ ] Резервная копия БД создана
- [ ] Миграции выполнены успешно
- [ ] Данные перенесены (проверено в tinker)
- [ ] Админка открывается без ошибок
- [ ] Редактирование услуг работает
- [ ] Создание новых услуг работает
- [ ] Публичные страницы отображаются
- [ ] Файлы загружаются корректно

## Контакты для поддержки

При возникновении проблем:
1. Проверьте логи: `storage/logs/laravel.log`
2. Выполните откат миграций
3. Восстановите БД из резервной копии

## Дальнейшие шаги

После успешного развёртывания:
1. Обновите документацию проекта
2. Протестируйте загрузку файлов в админке
3. Проверьте работу на production (если применимо)
