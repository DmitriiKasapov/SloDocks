# 06 — QA-сценарии (Фаза F)

## Цель
Пройти все пользовательские и административные сценарии на staging перед go-live.

---

## Правила прогона

- Тестировать в браузере вручную (не автотесты)
- Каждый сценарий — с чистой сессией (incognito)
- Фиксировать: ✅ прошёл / ❌ упал / ⚠️ работает с нюансом
- Найденные баги — исправить до go-live

---

## F1. Пользовательские сценарии

### Основной поток
- [ ] Открыть главную → увидеть список услуг
- [ ] Перейти на страницу услуги → прочитать публичное описание
- [ ] Нажать «Получить доступ» → появляется форма email
- [ ] Ввести невалидный email → получить ошибку валидации
- [ ] Ввести валидный email → попасть на Stripe Checkout
- [ ] Оплатить картой `4242 4242 4242 4242` → попасть на `/payment/success`
- [ ] Получить письмо с токеном (проверить inbox и папку спам)
- [ ] Перейти по ссылке из письма → увидеть платный контент
- [ ] Открыть ту же ссылку в другом браузере → контент доступен

### Повторный доступ
- [ ] Закрыть вкладку → снова открыть ссылку → контент открывается
- [ ] Открыть страницу услуги без токена → публичная версия + CTA

### Ошибки и граничные случаи
- [ ] Открыть страницу с неверным токеном → сообщение об ошибке (без деталей)
- [ ] Открыть страницу с истекшим токеном → «Срок доступа истёк» + кнопка покупки
- [ ] Открыть прямую ссылку на PDF без токена → 403 или 404
- [ ] Отменить оплату на Stripe → попасть на `/payment/cancel` → Access **не создан**
- [ ] Закрыть страницу Stripe не завершив → Purchase остался `pending`, Access не создан

### Повторная покупка
- [ ] Тот же email покупает ту же услугу второй раз → два независимых токена работают
- [ ] Тот же email покупает другую услугу → доступ только к купленной, не ко всем

### Скачивание файлов
- [ ] Нажать на файл в платном контенте → файл скачивается
- [ ] Попытаться угадать прямой URL файла → 403/404

---

## F2. Административные сценарии

### Услуги
- [ ] Войти в `/admin` → Filament dashboard
- [ ] Создать новую услугу → заполнить все поля → сохранить
- [ ] Отредактировать текст шага → сохранить → изменение видно на фронте
- [ ] Заменить PDF-файл → пользователь с активным токеном скачивает новый файл
- [ ] Отключить услугу (`is_active=false`) → страница возвращает 404
- [ ] Включить обратно → страница снова доступна

### Покупки
- [ ] Открыть список покупок → видны все покупки с email, суммой, статусом
- [ ] Фильтровать по статусу `paid` → только оплаченные
- [ ] Открыть детали покупки → видна вся информация

### Доступы
- [ ] Открыть список доступов → видны активные и истекшие
- [ ] Нажать «Повторно отправить email» → письмо уходит (проверить inbox)
- [ ] Нажать «Деактивировать» → токен перестаёт работать немедленно
- [ ] Проверить rate limit на resend: повторный клик в течение 5 минут → предупреждение

### Dashboard
- [ ] Счётчики (покупки, доступы, пользователи) отображаются корректно

---

## F3. SEO и технические проверки

- [ ] `https://staging.slodocs.si/sitemap.xml` — доступен, содержит URL услуг
- [ ] `https://staging.slodocs.si/robots.txt` — `Disallow: /` (staging закрыт)
- [ ] View Source главной → есть `<title>`, `<meta name="description">`, OG-теги
- [ ] View Source страницы услуги → Schema.org `<script type="application/ld+json">`
- [ ] Страница услуги без токена → нет утечки платного контента в HTML-источнике

---

## F4. Мобильная проверка

- [ ] Главная — читаемо на 375px (iPhone SE)
- [ ] Страница услуги — читаемо, CTA-кнопка видна
- [ ] Форма email — удобно вводить на мобильном
- [ ] Платный контент — шаги читаются

---

## Итоговый отчёт (заполнить)

```
Дата прогона: ____
Тестировал: ____
Браузеры: ____

Результаты:
  F1 Пользовательские: __ / __ прошли
  F2 Административные: __ / __ прошли
  F3 SEO/технические:  __ / __ прошли
  F4 Мобильная:        __ / __ прошли

Найденные баги:
  1. ____
  2. ____

Исправлено:
  1. ____
  2. ____

Решение: ✅ Готово к Go Live / ❌ Требуются исправления
```

---

## ✅ Критерий завершения Фазы F

Все сценарии F1–F4 отмечены ✅. Отчёт заполнен. Ноль критических багов.
