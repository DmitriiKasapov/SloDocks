# 09 — Шаблоны задач для Claude

## Как использовать
Скопировать шаблон → заполнить → передать Claude как задачу в начале сессии.

---

## Шаблон задачи

```
Контекст: [1–2 предложения о проекте и текущей фазе]
Цель: [1 предложение — что нужно получить]
Ограничения: [список — что нельзя менять, не трогать]
Входные файлы: [пути к файлам]
Выход: [чеклист / патч / конкретные файлы / псевдокод]
Критерий готовности: [как понять, что задача выполнена]
```

---

## Готовые задачи

### T-01: Проверка environment matrix
```
Контекст: Laravel 12, три окружения — local, staging, production.
Цель: Сверить .env.example с таблицей из plan/step2/01-local-stabilization.md
и найти пропущенные или лишние переменные.
Ограничения: не менять бизнес-логику, только ENV.
Входные файлы: .env.example, plan/step2/01-local-stabilization.md
Выход: список расхождений + обновлённый .env.example
Критерий: все переменные из matrix присутствуют в .env.example с комментариями
```

### T-02: Проверка идемпотентности webhook
```
Контекст: Stripe webhook checkout.session.completed обрабатывается в ProcessStripeWebhook job.
Цель: Убедиться, что повторная доставка одного события не создаёт дубль Access.
Ограничения: не менять схему БД, не трогать миграции.
Входные файлы: app/Jobs/ProcessStripeWebhook.php, app/Services/AccessGrantService.php
Выход: описание всех точек проверки + список мест, где может возникнуть дубль
Критерий: явный список "здесь защита есть / здесь защиты нет"
```

### T-03: Аудит безопасности токена в URL
```
Контекст: access_token передаётся как ?token=xxx в URL. SetReferrerPolicy middleware установлен.
Цель: Проверить все места, где токен может утечь — логи, заголовки, внешние запросы.
Ограничения: не менять архитектуру доступа, только найти утечки.
Входные файлы: app/Http/Middleware/, app/Http/Controllers/ServiceController.php, config/logging.php
Выход: список найденных утечек + конкретные строки кода
Критерий: токен не попадает в access_log Nginx, не пишется в Laravel-логи
```

### T-04: Deploy script
```
Контекст: Laravel на VPS (Ubuntu 22.04, Nginx, PHP 8.2, PostgreSQL).
Цель: Создать bash-скрипт deploy.sh для ручного деплоя по шагам из 08-ops-and-maintenance.md.
Ограничения: без CI/CD, только git pull + artisan команды.
Входные файлы: plan/step2/08-ops-and-maintenance.md
Выход: файл deploy.sh с set -e, цветным выводом, проверкой статуса каждого шага
Критерий: скрипт завершается с ненулевым кодом при первой ошибке
```

### T-05: Проверка FileController
```
Контекст: PDF-файлы хранятся на private disk, отдаются через FileController.
Цель: Убедиться, что whitelist полей рабочий и нет возможности скачать файл без токена.
Ограничения: не менять бизнес-логику доступа.
Входные файлы: app/Http/Controllers/FileController.php, routes/web.php
Выход: список возможных обходов защиты + рекомендации
Критерий: прямой URL /services/{slug}/file/{любое_поле} без токена → 403
```

### T-06: Контент-наполнение услуги
```
Контекст: SloDocs — портал для иностранцев в Словении. Услуга: [название].
Цель: Написать контент для Filament-админки по стандарту из plan/step2/05-content-mvp.md.
Ограничения: 4–6 шагов, только практические действия, без истории и законов, на русском.
Входные файлы: plan/step2/05-content-mvp.md
Выход: готовый текст по блокам (шаги + FAQ) для копипасты в Filament
Критерий: каждый шаг — конкретное действие, FAQ — 5 вопросов с ответами
```

### T-07: Email шаблон — проверка ссылок
```
Контекст: Email AccessGrantedMail.php отправляет ссылку с токеном.
Цель: Убедиться, что APP_URL берётся из конфига, не hardcode, и ссылка формируется корректно.
Входные файлы: app/Mail/AccessGrantedMail.php, resources/views/emails/access-granted.blade.php
Выход: анализ + исправление если нужно
Критерий: ссылка в письме = APP_URL + /services/{slug}?token={token}
```

### T-08: QA-прогон (помощь в фиксации)
```
Контекст: Прогон сценариев из plan/step2/06-qa-scenarios.md на staging.
Цель: Зафиксировать результаты каждого сценария и заполнить итоговый отчёт.
Ограничения: тестировать только на staging, не на production.
Входные файлы: plan/step2/06-qa-scenarios.md
Выход: заполненный отчёт в конце 06-qa-scenarios.md
Критерий: все чекбоксы заполнены (✅/❌), отчёт подписан
```
