# Security and Abuse — SloDocs (MVP)

## Назначение документа
Зафиксировать базовые меры безопасности, защиты от злоупотреблений
и антибот-подходы для MVP.

Документ:
- не описывает enterprise-безопасность
- ориентирован на практический уровень MVP
- используется как ориентир при реализации backend и платежей

Документ зафиксирован для MVP.

---

## Общие принципы безопасности

- безопасность достаточна для MVP, но не избыточна
- приоритет — защита платежей и доступа к платному контенту
- все критичные проверки выполняются на сервере
- отсутствие доверия к клиенту (browser)

---

## Безопасность оплаты

### Общие требования
- все платежи проходят через внешний платёжный провайдер
- сервер не хранит данные банковских карт
- статус оплаты определяется **только** по webhook от провайдера

---

### Webhook-проверки
- проверка подписи webhook (secret / signature)
- проверка уникальности `payment_id`
- идемпотентная обработка повторных webhook-событий
- доступ выдаётся **только** при статусе `paid`

---

### Защита от подмены оплаты
- запрет выдачи доступа по frontend-событиям
- frontend не влияет на статус покупки
- кнопка «Оплатить» не означает успешную оплату

---

## Защита доступа к платному контенту

### Access Token
- доступ осуществляется через уникальный `access_token`
- токен:
  - длинный
  - случайный
  - не угадываемый
- токен проверяется на сервере при каждом запросе

---

### Ограничения доступа
- доступ ограничен:
  - по токену
  - по сроку (`expires_at`)
  - по флагу `is_active`
- при истечении срока доступ закрывается автоматически

---

### Защита файлов
- файлы не имеют публичных URL
- файлы отдаются через backend
- прямая ссылка на файл без проверки доступа невозможна

---

## Защита от ботов и автоматических атак

### Формы и оплата
- rate limiting на:
  - попытки оплаты
  - запросы доступа
- базовая защита от массовых запросов

---

### Email
- ограничение количества email-отправок
- защита от повторных отправок ссылок доступа
- задержка между повторными запросами

---

## Защита от злоупотреблений

### Повторные попытки оплаты
- ограничение количества попыток оплаты за сессию
- блокировка при аномальной активности

---

### Массовый доступ
- защита от перебора access_token
- логирование невалидных попыток доступа
- временная блокировка при превышении лимитов

---

## Логирование и наблюдаемость

Логируются:
- ошибки оплаты
- невалидные webhook-запросы
- неудачные попытки доступа
- превышения лимитов

Логи используются:
- для диагностики
- для выявления злоупотреблений
- без хранения персональных данных сверх необходимого

---

## Административная безопасность

- админка:
  - закрыта от индексации
  - защищена дополнительным доступом
- отсутствие публичных ссылок на админку
- логирование действий администратора

---

## Защита от утечек контента

- отсутствие прямых ссылок на платные материалы
- отсутствие API, возвращающего весь контент без проверки доступа
- невозможность скачать материалы без активного доступа

Примечание:
- защита от копирования (скриншоты, сохранение PDF) **не гарантируется**
- проект использует разумные, а не абсолютные меры защиты

---

## Что осознанно НЕ реализуется в MVP

- DRM
- watermarking файлов
- fingerprinting пользователей
- поведенческий анализ
- внешние антифрод-системы
- CAPTCHA на всех формах

---

## Итог

Безопасность в MVP:
- защищает оплату
- защищает доступ
- предотвращает очевидные злоупотребления
- не усложняет разработку

Документ считается зафиксированным для MVP.
