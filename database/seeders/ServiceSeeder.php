<?php

namespace Database\Seeders;

use App\Models\Category;
use App\Models\MaterialBlock;
use App\Models\Service;
use App\Models\Tag;
use Illuminate\Database\Seeder;

class ServiceSeeder extends Seeder
{
    public function run(): void
    {
        $category = Category::firstOrCreate(
            ['slug' => 'education'],
            ['name' => 'Образование', 'order' => 0]
        );

        $service = Service::create([
            'slug' => 'school-enrollment',
            'title' => 'Оформление ребёнка в школу в Словении',
            'intro_text' => '<p>Оформление ребёнка в словенскую школу — важный этап для семей, переехавших в Словению. Процесс может показаться сложным, но на самом деле он вполне понятен и доступен.</p><p>В этом материале мы подробно разобрали все этапы: от подготовки документов до первого дня в школе. Вы получите пошаговую инструкцию, список необходимых документов с пояснениями, заполненные образцы заявлений и практические советы из реального опыта.</p>',
            'category_id' => $category->id,
            'description_public' => 'Подробная инструкция по оформлению ребёнка в словенскую школу. Включает пошаговое руководство, список необходимых документов, заполненные образцы и практические советы.',
            'price' => 2900,
            'access_duration_days' => 30,
            'seo_title' => 'Оформление ребёнка в школу в Словении | Пошаговая инструкция',
            'seo_description' => 'Полное руководство по зачислению ребёнка в школу в Словении. Документы, сроки, образцы заявлений.',
            'is_active' => true,
        ]);

        // Attach tags to the service
        $tags = Tag::whereIn('slug', ['shkola', 'dokumenty', 'roditelyam', 'instrukcii'])->pluck('id');
        $service->tags()->attach($tags);

        // Process overview
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_PROCESS_OVERVIEW,
            'title' => 'Обзор процесса',
            'content' => [
                'steps' => [
                    'Подготовка документов',
                    'Определение школьного округа',
                    'Подача заявления в школу',
                    'Медицинский осмотр',
                    'Зачисление и начало учебы',
                ],
            ],
            'order' => 1,
            'is_active' => true,
        ]);

        // Step 1
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_STEPS,
            'title' => 'Шаг 1: Подготовка документов',
            'content' => [
                'steps' => [
                    [
                        'number' => 1,
                        'title' => 'Подготовка документов',
                        'description' => '<p>Для зачисления ребёнка в словенскую школу вам потребуются следующие документы:</p>
                        <ul>
                            <li><strong>Свидетельство о рождении ребёнка</strong> — оригинал или нотариально заверенная копия с апостилем</li>
                            <li><strong>Загранпаспорт ребёнка</strong> — копия всех страниц с отметками</li>
                            <li><strong>Справка о месте жительства</strong> (potrdilo o prijavi stalnega ali začasnega prebivališča) — получается в административной единице (upravna enota)</li>
                            <li><strong>Медицинская карта</strong> с записями о прививках — переведённая на словенский язык и заверенная</li>
                            <li><strong>Справка из предыдущей школы</strong> (если ребёнок учился ранее) — с оценками и программой обучения</li>
                        </ul>
                        <p class="mt-4"><strong>Важно:</strong> Все документы на иностранном языке должны быть переведены на словенский язык присяжным переводчиком и нотариально заверены.</p>',
                    ],
                ],
            ],
            'order' => 2,
            'is_active' => true,
        ]);

        // Step 2
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_STEPS,
            'title' => 'Шаг 2: Определение школьного округа',
            'content' => [
                'steps' => [
                    [
                        'number' => 2,
                        'title' => 'Определение школьного округа',
                        'description' => '<p>В Словении дети посещают школу по месту жительства. Каждая школа обслуживает определённый округ (šolski okoliš).</p>
                        <p><strong>Как найти свою школу:</strong></p>
                        <ol>
                            <li>Зайдите на сайт общины (občina), где вы проживаете</li>
                            <li>Найдите раздел "Основные школы" (osnovne šole)</li>
                            <li>Проверьте карту школьных округов или список улиц</li>
                            <li>Свяжитесь со школой по телефону или email для уточнения</li>
                        </ol>
                        <p class="mt-4"><strong>Совет:</strong> Некоторые школы принимают детей вне округа при наличии свободных мест. Уточните этот момент напрямую в школе.</p>',
                    ],
                ],
            ],
            'order' => 3,
            'is_active' => true,
        ]);

        // Step 3
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_STEPS,
            'title' => 'Шаг 3: Подача заявления в школу',
            'content' => [
                'steps' => [
                    [
                        'number' => 3,
                        'title' => 'Подача заявления в школу',
                        'description' => '<p>После определения школы нужно подать заявление о зачислении (vloga za vpis).</p>
                        <p><strong>Порядок действий:</strong></p>
                        <ul>
                            <li>Позвоните в школу и договоритесь о встрече с директором или секретарём</li>
                            <li>Принесите с собой все подготовленные документы</li>
                            <li>Заполните форму заявления (обычно выдаётся на месте)</li>
                            <li>Школа проведёт краткое собеседование с ребёнком для оценки уровня знаний</li>
                        </ul>
                        <p class="mt-4"><strong>Что происходит дальше:</strong></p>
                        <p>Школа рассматривает заявление в течение 2-5 рабочих дней. Если ребёнок не владеет словенским языком, ему будут назначены дополнительные уроки словенского (dopolnilni pouk slovenščine) — бесплатно.</p>',
                    ],
                ],
            ],
            'order' => 4,
            'is_active' => true,
        ]);

        // Step 4
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_STEPS,
            'title' => 'Шаг 4: Медицинский осмотр',
            'content' => [
                'steps' => [
                    [
                        'number' => 4,
                        'title' => 'Медицинский осмотр',
                        'description' => '<p>Перед началом учебы ребёнок должен пройти медицинский осмотр в поликлинике (zdravstveni dom).</p>
                        <p><strong>Что входит в осмотр:</strong></p>
                        <ul>
                            <li>Общий осмотр педиатра</li>
                            <li>Проверка зрения и слуха</li>
                            <li>Проверка наличия обязательных прививок</li>
                            <li>Справка о пригодности к обучению</li>
                        </ul>
                        <p class="mt-4"><strong>Важно:</strong> Запишитесь на осмотр заранее — в некоторых поликлиниках очередь может быть до 2-3 недель. Осмотр бесплатный при наличии медицинской страховки.</p>',
                    ],
                ],
            ],
            'order' => 5,
            'is_active' => true,
        ]);

        // Step 5
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_STEPS,
            'title' => 'Шаг 5: Зачисление и начало учебы',
            'content' => [
                'steps' => [
                    [
                        'number' => 5,
                        'title' => 'Зачисление и начало учебы',
                        'description' => '<p>После получения всех документов школа официально зачисляет ребёнка и сообщает дату начала занятий.</p>
                        <p><strong>Что нужно знать:</strong></p>
                        <ul>
                            <li>Учебный год в Словении начинается 1 сентября</li>
                            <li>Зачисление возможно в течение всего учебного года</li>
                            <li>Учебники и школьные принадлежности обычно предоставляются школой бесплатно</li>
                            <li>Питание в школе платное (около 2-3 € за обед)</li>
                            <li>Продлёнка (podaljšano bivanje) доступна за отдельную плату</li>
                        </ul>
                        <p class="mt-4"><strong>Первые дни в школе:</strong></p>
                        <p>Школа проведёт адаптационную встречу с ребёнком и родителями, расскажет о правилах, расписании и дополнительных занятиях. Если ребёнок не знает словенского, ему будут предоставлены индивидуальные уроки.</p>',
                    ],
                ],
            ],
            'order' => 6,
            'is_active' => true,
        ]);

        // Tip block
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_TIP,
            'title' => 'Полезный совет',
            'content' => [
                'text' => '<p>Начните процесс оформления как можно раньше — особенно если переезжаете в середине учебного года. Это даст вам время на сбор документов, переводы и прохождение всех формальностей без спешки.</p>',
            ],
            'order' => 7,
            'is_active' => true,
        ]);

        // FAQ block
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_FAQ,
            'title' => 'Часто задаваемые вопросы',
            'content' => [
                'items' => [
                    [
                        'q' => 'Нужно ли знать словенский язык для поступления в школу?',
                        'a' => 'Нет, знание словенского языка не является обязательным условием. Школа предоставит ребёнку бесплатные дополнительные уроки словенского языка (dopolnilni pouk).',
                    ],
                    [
                        'q' => 'Сколько стоит обучение в государственной школе?',
                        'a' => 'Обучение в государственных основных школах (osnovne šole) полностью бесплатное. Оплачивается только питание и, при необходимости, продлёнка.',
                    ],
                    [
                        'q' => 'Можно ли записать ребёнка в школу не по месту жительства?',
                        'a' => 'Да, но только при наличии свободных мест в выбранной школе и с согласия директора. Приоритет всегда отдаётся детям из закреплённого за школой округа.',
                    ],
                    [
                        'q' => 'Что делать, если у ребёнка нет всех прививок?',
                        'a' => 'Отсутствие обязательных прививок не является препятствием для зачисления, но родителям будет рекомендовано завершить вакцинацию в местной поликлинике.',
                    ],
                ],
            ],
            'order' => 8,
            'is_active' => true,
        ]);

        // Help CTA block
        MaterialBlock::create([
            'service_id' => $service->id,
            'type' => MaterialBlock::TYPE_HELP_CTA,
            'title' => 'Нужна помощь?',
            'content' => [
                'text' => '<p>Если у вас остались вопросы или возникли сложности с оформлением, вы можете обратиться за консультацией в ближайшую административную единицу (upravna enota) или связаться с выбранной школой напрямую.</p>',
            ],
            'order' => 9,
            'is_active' => true,
        ]);
    }
}
